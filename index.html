<!DOCTYPE html>
<html>
<head>
    <title>Mines Housing Tactical Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: #1a1a1a; color: white; }
        #map { height: 85vh; width: 100%; background: #222; border-top: 2px solid #333; }
        .controls { padding: 15px; background: #222; display: flex; justify-content: center; align-items: center; gap: 20px; }
        select { padding: 8px 12px; border-radius: 5px; border: none; background: #444; color: white; cursor: pointer; }
        h1 { margin: 10px 0; font-size: 1.5rem; color: #d4af37; /* Mines Gold */ }
        .legend { font-size: 0.8rem; color: #ccc; }
    </style>
</head>
<body>

    <h1>Mines Housing Tactical Map</h1>
    
    <div class="controls">
        <div>
            <label>Current Floor: </label>
            <select id="floorSelect" onchange="changeFloor(this.value)">
                <option value="Floor 1">Floor 1</option>
                <option value="Floor 2">Floor 2</option>
                <option value="Floor 3">Floor 3</option>
            </select>
        </div>
        <div class="legend">Click tiles to toggle demand (Red = High Priority)</div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // 1. CONFIGURATION - Change these to match your actual PNG sizes
        var imgWidth = 2000;
        var imgHeight = 1500;
        var gridSize = 60; // Size of selection tiles in pixels

        var floorPlans = {
            "Floor 1": "floor1.png",
            "Floor 2": "floor2.png",
            "Floor 3": "floor3.png"
        };

        // 2. SETUP MAP (Simple Coordinate System)
        var map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -1,
            maxZoom: 2
        });

        // Map pixel coordinates to Leaflet coordinates
        var southWest = map.unproject([0, imgHeight], map.getMaxZoom()-1);
        var northEast = map.unproject([imgWidth, 0], map.getMaxZoom()-1);
        var bounds = new L.LatLngBounds(southWest, northEast);

        // 3. LOAD INITIAL IMAGE
        var currentImageLayer = L.imageOverlay(floorPlans["Floor 1"], bounds).addTo(map);
        map.fitBounds(bounds);

        // 4. FUNCTION TO SWITCH FLOORS
        function changeFloor(floorName) {
            var newUrl = floorPlans[floorName];
            currentImageLayer.setUrl(newUrl);
            
            // Optional: Reset tiles when switching floors? 
            // For now, they stay drawn on top.
        }

        // 5. GENERATE THE SELECTION GRID
        // We use a LayerGroup so we can manage all tiles together
        var tileLayer = L.layerGroup().addTo(map);

        for (var x = 0; x < imgWidth; x += gridSize) {
            for (var y = 0; y < imgHeight; y += gridSize) {
                
                // Calculate corners of the tile
                var p1 = map.unproject([x, y], map.getMaxZoom()-1);
                var p2 = map.unproject([x + gridSize, y + gridSize], map.getMaxZoom()-1);
                var tileBounds = [p1, p2];
                
                var rect = L.rectangle(tileBounds, {
                    color: "#3388ff",
                    weight: 1,
                    fillOpacity: 0.05, // Almost invisible until clicked
                    interactive: true
                });

                // Interaction Logic
                rect.on('click', function(e) {
                    var tile = e.target;
                    if (tile.options.fillOpacity < 0.2) {
                        // Mark as high demand
                        tile.setStyle({
                            fillColor: '#ff0000',
                            fillOpacity: 0.6,
                            color: '#ff0000'
                        });
                    } else {
                        // Reset to neutral
                        tile.setStyle({
                            fillColor: '#3388ff',
                            fillOpacity: 0.05,
                            color: '#3388ff'
                        });
                    }
                });

                rect.addTo(tileLayer);
            }
        }
    </script>
</body>
</html>